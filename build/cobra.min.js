/*
* Cobra 0.1.7
* Obogo. MIT 2014
*/
!function(a,b){function c(a){for(var b,d,e=Array.prototype.slice.call(arguments,0),f=1,g=e.length,h=this||{};g>f;){b=e[f];for(d in b)b.hasOwnProperty(d)&&(a[d]&&"object"==typeof a[d]?a[d]=c.apply(h,[a[d],b[d]]):b[d]instanceof Array?(a[d]=a[d]||(h&&h.arrayAsObject?{length:b[d].length}:[]),b[d].length&&(a[d]=c.apply(h,[a[d],b[d]]))):b[d]&&"object"==typeof b[d]?(h.objectsAsArray&&"number"==typeof b[d].length&&(a[d]instanceof Array||(a[d]=[])),a[d]=c.apply(h,[a[d]||{},b[d]])):a[d]=b[d]);f+=1}return a}b.cobra=a;var d={};d.isArray=function(a){return a&&!!a.isArray},d.isBoolean=function(a){return"boolean"==typeof a},d.isDate=function(a){return a instanceof Date&&!isNaN(a.valueOf())},d.isDefined=function(a){return"undefined"!=typeof a},d.isEmpty=function(a){if(d.isString(a))return""===a;if(d.isArray(a))return 0===a.length;if(d.isObject(a)){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}return!1},d.isFunction=function(a){return"function"==typeof a},d.isNativeFunction=function(a){return"function"==typeof a&&(a.toString().indexOf("[native code]")>-1||a.toString().indexOf("[function]")>-1)||!!window[a.name]},d.isNull=function(a){return null===a},d.isNumber=function(a){return"number"==typeof a},d.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},d.isObject=function(a){return null!==a&&"object"==typeof a},d.isRegExp=function(a){return a&&a instanceof RegExp},d.isSchema=function(b){return b instanceof a.Schema},d.isString=function(a){return"string"==typeof a},d.isUndefined=function(a){return"undefined"==typeof a},function(){function b(a,b,c,e){this.name="SchemaInvalidTypeError",this.type=a,this.actualType=d(typeof c),this.property=b.substr(5),this.value=c,this.message=e||'Schema found type "{actualType}" where it expected type "{type}" :: {prop} => {val}'.supplant({actualType:this.actualType,type:d(this.type),prop:this.property,val:this.value})}function c(a,b){this.name="SchemaRequiredPropertyError",this.property=a.substr(5),this.message=b||'property "{prop}" is required'.supplant({prop:a})}function d(a){return a.charAt(0).toUpperCase()+a.slice(1)}b.prototype=Error.prototype,c.prototype=Error.prototype,a.SchemaInvalidTypeError=b,a.SchemaRequiredPropertyError=c}(),function(){function b(){}function c(a,b,c){b=b||"";for(var d,e=b.match(/(\w|\$)+/g),f="undefined"==typeof c;e.length>1;)switch(d=e.shift(),typeof a[d]){case"object":a=a[d];break;case"undefined":if(f)return;a=a[d]={};break;default:throw new Error("property is not of type object",d)}return"undefined"==typeof c?a[e.shift()]:(a[e.shift()]=c,c)}b.extend=function(a,b){var c=/^([\w\$]+)$/.test(a);if(!c)throw new Error('Invalid name: "{name}"'.supplant({name:a}));this.prototype[a]=b},b.factory=function(d,e){function f(b){a.extend(this,b)}f.statics={};var g=f.prototype=b.prototype;return g.__name=d,g.__schema=e,g.getName=function(){return this.__name},g.getSchema=function(){return this.__schema},g.get=function(a){return c(this,a)},g.set=function(a,b){return c(this,a,b)},g.options=function(a,b){return arguments.length?void 0===b?e.options[a]:void(e.options[a]=b):e.options},g.applySchema=function(a){return this.getSchema().applySchema(this,a)},f},a.Model=b}(),function(){var b={},c={},e={},f=d.isUndefined,g=d.isNull,h=1;a.applySchemaType=function(b,c){var d=a.schemaType(b),e=new d;return e.exec(c)},a.applySchemaHelper=function(b,c){var d=a.schemaHelper(b);return d(c)},a.schemaType=function(b,d){return f(d)?c[b]:(a.Schema.Types[b]={name:b},c[b]=d,this)},a.schemaHelper=function(b,c){return f(c)?e[b]:(a.Schema.Types[b]={name:b},e[b]=c,this)},a.model=function(c,d){return f(d)?a.Model.factory(c,b[c]):g(d)?delete b[c]:(b[c]=d,this)},a.validate=function(b,c,d){D.alwaysAsync=!1;var e=h++,f=new a.Schema({value:c});a.model("$model"+e,f);var g=a.model("$model"+e),i=new g({value:b}),j={},k=i.applySchema(d);return k.then(function(b){a.model("$model"+e,null),j.isValid=!0,j.value=b.value},function(b){a.model("$model"+e,null),j.isValid=!1,j.error=b}),D.alwaysAsync=!0,j}}(),function(){function b(a,b){k[a]=b}function c(b,c){if(m(c))throw new a.SchemaRequiredPropertyError(b);return c}function e(a,b){return m(a)?n(b)?b():b:a}function f(b,c){var d;for(var e in c)c.hasOwnProperty(e)&&(d=a.schemaHelper(e),n(d)&&(b=d(b,c[e])));return b}function g(a,b,c,d){var e=this,f=D();try{var g=i("data",a,b,c,d);e.errors&&e.errors.length?f.reject(e.errors):f.resolve(g)}catch(h){f.reject(h)}return f.promise}function h(b,c,e,f){for(var g,h,i,j,k=b.name?b.name:String(b),l=String(k).split("|"),n=0,o=l.length,p=!1;o>n;){try{if(d.isRegExp(b))throw b.test(String(e))&&(i=e),new Error("Invalid type");if(d.isFunction(b)&&!d.isNativeFunction(b)){if(j=b(e,{}),q(j)){i=j;break}}else if(g=a.schemaType(l[n]),h=new g,j=h.exec(e,{}),q(j)){i=j;break}}catch(r){p=!0}n+=1}if(m(i)&&p){var s=new a.SchemaInvalidTypeError(k,c.split("._val").join(""),e);if(!f)throw s;f.push(s)}return i}function i(a,b,d,g,j){var k,l,n,t={};for(k in d)if(d.hasOwnProperty(k)){if(n=d[k],l=e(b[k],n.default),n.required&&(l=c(k,l)),l=f(l,n),m(l))continue;if(s(g.ignore)&&-1!==g.ignore.indexOf(l))continue;if(o(l)){t[k]=null;continue}if(p(n))t[k]=h(n,a+"."+k,l,j);else if(n.type)t[k]=h(n.type,a+"."+k,l,j);else if(n.name)t[k]=h(n,a+"."+k,l,j);else if(r(n))t[k]=l;else if(q(l))if(l.isArray){if(q(n[0]))for(var u,v=n[0],w=l.length,x=0;w>x;x++)u=i(a+"."+k+"["+x+"]",{_val:l[x]},{_val:v},g,j),l[x]=u._val;t[k]=l}else l=i(a,l||{},n,g,j),t[k]=l}return t}function j(a,b){this.definitions=a||{},this.options=b||{},this.errors=[]}var k={},l=d,m=l.isUndefined,n=l.isFunction,o=l.isNull,p=l.isString,q=l.isDefined,r=l.isEmpty,s=l.isArray;j.type=b,j.Types={},j.prototype.applySchema=function(a,b){var c=b||this.options;return this.errors=c.breakOnError===!1?[]:null,g.apply(this,[a,this.definitions,c,this.errors])},a.Schema=j}(),a.schemaHelper("ceil",function(a,b){return b&&(a=Math.ceil(a)),a}),a.schemaHelper("floor",function(a,b){return b&&(a=Math.floor(a)),a}),a.schemaHelper("max",function(a,b){return d.isNumber(b)&&(a=Math.max(a,b)),a}),a.schemaHelper("min",function(a,b){return d.isNumber(b)&&(a=Math.min(a,b)),a}),a.schemaHelper("round",function(a,b){return b&&(a=Math.round(a)),a}),a.schemaHelper("lowercase",function(a,b){return b&&d.isString(a)&&(a=a.toLowerCase()),a}),a.schemaHelper("trim",function(a,b){return b&&d.isString(a)&&(a=a.trim()),a}),a.schemaHelper("uppercase",function(a,b){return b&&d.isString(a)&&(a=a.toUpperCase()),a}),Array.prototype.isArray=!0,Object.defineProperty(Array.prototype,"isArray",{enumerable:!1,writable:!0}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null===this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(1/0===Math.abs(f)&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),function(){Date.prototype.toISOString||!function(){function a(a){return 10>a?"0"+a:a}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}()}(),String.prototype.supplant=function(a){return this.replace(/{([^{}]*)}/g,function(b,c){var d=a[c];return"string"==typeof d||"number"==typeof d?d:b})},a.schemaType("Array",function(){this.exec=function(a){if(d.isArray(a))return a;throw new Error("Invalid integer")}}),a.schemaType("Boolean",function(){this.exec=function(a){if(d.isBoolean(a))return a;if("string"==typeof a){switch(a){case"0":case"false":a=!1;break;case"1":case"true":a=!0;break;default:throw new Error("Invalid boolean")}return a}if("number"==typeof a)return!!a;throw new Error("Invalid boolean")}}),a.schemaType("Currency",function(){var a=/^\s*(\+|-)?((\d+(\.\d\d)?)|(\.\d\d))\s*$/;this.exec=function(b){var c=-1!==String(b).search(a);if(c)return String(b);if(d.isNull(b))return String(Number(b));throw new Error("Currency can have either 0 or 2 decimal places. => "+b)}}),a.schemaType("Date",function(){function a(a){return"[object Date]"===Object.prototype.toString.call(a)&&"invalid date"!==String(a).toLowerCase()}this.exec=function(b){var c=new Date;if(d.isNull(b)||(c=new Date(b)),!a(c))throw new Error("Invalid date format");return c}}),a.schemaType("Email",function(){this.exec=function(a){var b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!b.test(a))throw new Error("Invalid email");return a}}),a.schemaType("Int",function(){var a=/^\s*(\-)?\d+\s*$/;this.exec=function(b){if(isNaN(Number(b)))throw new Error("Invalid integer");if(-1===String(Number(b)).search(a))throw new Error("Invalid integer");return b||Number(b)}}),a.schemaType("Mixed",function(){this.exec=function(a){return a}}),a.schemaType("Number",function(){this.exec=function(a){if(d.isNumeric(a))return Number(a);throw new Error("Invalid number")}}),a.schemaType("String",function(){this.exec=function(a){return d.isNull(a)?null:String(a)}}),function(a){"use strict";function b(a){j(function(){throw a})}function c(b){return this.then(b,a)}function d(b){return this.then(a,b)}function e(b,c){return this.then(function(a){return k(b)?b.apply(null,l(a)?a:[a]):t.onlyFuncs?a:b},c||a)}function f(a){function b(){a()}return this.then(b,b),this}function g(a){return this.then(function(b){return k(a)?a.apply(null,l(b)?b.splice(0,0,void 0)&&b:[void 0,b]):t.onlyFuncs?b:a},function(b){return a(b)})}function h(c){return this.then(a,c?function(a){throw c(a),a}:b)}function i(a,b){var c=o(a);if(1===c.length&&l(c[0])){if(!c[0].length)return t.fulfilled([]);c=c[0]}var d=[],e=t(),f=c.length;if(f)for(var g=(function(a){c[a]=t.promisify(c[a]),c[a].then(function(g){a in d||(d[a]=b?c[a]:g,--f||e.resolve(d))},function(g){a in d||(b?(d[a]=c[a],--f||e.resolve(d)):e.reject(g))})}),h=0,i=f;i>h;h++)g(h);else e.resolve(d);return e.promise}var j,k=function(a){return"function"==typeof a},l=function(a){return Array.isArray?Array.isArray(a):a instanceof Array},m=function(a){return!(!a||!(typeof a).match(/function|object/))},n=function(b){return b===!1||b===a||null===b},o=function(a,b){return[].slice.call(a,b)},p="undefined",q=typeof TypeError===p?Error:TypeError;if(typeof process!==p&&process.nextTick)j=process.nextTick;else if(typeof MessageChannel!==p){var r=new MessageChannel,s=[];r.port1.onmessage=function(){s.length&&s.shift()()},j=function(a){s.push(a),r.port2.postMessage(0)}}else j=function(a){setTimeout(a,0)};var t=function(b){function i(){if(0!==s){var a,b=u,c=0,d=b.length,e=~s?0:1;for(u=[];d>c;c++)(a=b[c][e])&&a(p)}}function l(a){function b(a){return function(b){return c?void 0:(c=!0,a(b))}}var c=!1;if(s)return this;try{var d=m(a)&&a.then;if(k(d)){if(a===v)throw new q("Promise can't resolve itself");return d.call(a,b(l),b(o)),this}}catch(e){return b(o)(e),this}return r(function(){p=a,s=1,i()}),this}function o(a){return s||r(function(){try{throw a}catch(b){p=b}s=-1,i()}),this}var p,r=(a!==b?b:t.alwaysAsync)?j:function(a){a()},s=0,u=[],v={then:function(a,b){var c=t();return u.push([function(b){try{c.resolve(n(a)?b:k(a)?a(b):t.onlyFuncs?b:a)}catch(d){c.reject(d)}},function(a){if((n(b)||!k(b)&&t.onlyFuncs)&&c.reject(a),b)try{c.resolve(k(b)?b(a):b)}catch(d){c.reject(d)}}]),0!==s&&r(i),c.promise},success:c,error:d,otherwise:d,apply:e,spread:e,ensure:f,nodify:g,rethrow:h,isPending:function(){return!(0!==s)},getStatus:function(){return s}};return v.toSource=v.toString=v.valueOf=function(){return p===a?this:p},{promise:v,resolve:l,fulfill:l,reject:o}};t.deferred=t.defer=t,t.nextTick=j,t.alwaysAsync=!0,t.onlyFuncs=!0,t.resolved=t.fulfilled=function(a){return t(!0).resolve(a).promise},t.rejected=function(a){return t(!0).reject(a).promise},t.wait=function(a){var b=t();return setTimeout(b.resolve,a||0),b.promise},t.delay=function(a,b){var c=t();return setTimeout(function(){try{c.resolve(a.apply(null))}catch(b){c.reject(b)}},b||0),c.promise},t.promisify=function(a){return a&&k(a.then)?a:t.resolved(a)},t.all=function(){return i(arguments,!1)},t.resolveAll=function(){return i(arguments,!0)},t.nodeCapsule=function(a,b){return b||(b=a,a=void 0),function(){var c=t(),d=o(arguments);d.push(function(a,b){a?c.reject(a):c.resolve(arguments.length>2?o(arguments,1):b)});try{b.apply(a,d)}catch(e){c.reject(e)}return c.promise}},typeof window!==p&&(window.D=t),typeof module!==p&&module.exports&&(module.exports=t)}(),a.validators=d,a.extend=c}({},function(){return this}());