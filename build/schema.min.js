/*
* Schema v.0.0.1
* Rob Taylor. MIT 2014
*/
!function(a,b){b.sly=a,function(){function a(b,c){b=b||{};for(var d in c)c.hasOwnProperty(d)&&(b[d]="object"==typeof c[d]?a(b[d],c[d]):c[d]);return b}function b(){this._schemas={},this._schemaTypes={},this._schemaFormats={}}function c(a,b){m[a]=b}function d(a,b){if(k.isUndefined(b))throw new Error('property "{prop}" is required'.supplant({prop:a}));return b}function e(a,b){return k.isUndefined(a)?k.isFunction(b)?b():b:a}function f(a,b){var c;for(var d in b)b.hasOwnProperty(d)&&(c=l.schemaFormat(d),k.isFunction(c)&&(a=c(a,b[d])));return a}function g(a,b){var c=Q.defer();return setTimeout(function(){try{var d=h(a,b);c.resolve(d)}catch(e){c.reject(e)}},1),c.promise}function h(a,b){var c,g,i,j,m={};for(c in b)if(b.hasOwnProperty(c))if(i=b[c],g=e(a[c],i.default),i.required&&(g=d(c,g)),g=f(g,i),i.type){if(j=l.schemaType(i.type.name),!j(g,i))throw new Error(n.supplant({foundType:typeof g,expectType:i.type.name,val:g}));m[c]=g}else if(i.name){if(j=l.schemaType(i.name),!j(g,i))throw new Error(n.supplant({foundType:typeof g,expectType:i.name,val:g}));m[c]=g}else k.isEmpty(i)?m[c]=g:(g=h(g||{},i),k.isEmpty(g)||(m[c]=g));return m}function i(a){this.schema=a}function j(){}var k;window._?k=window._:(Array.prototype.isArray=!0,k={},k.extend=a,k.isString=function(a){return"string"==typeof a},k.isBoolean=function(a){return"boolean"==typeof a},k.isNumber=function(a){return"number"==typeof a},k.isArray=function(a){return!!a.isArray},k.isEmpty=function(a){if(k.isString(a))return""===a;if(k.isArray(a))return 0===a.length;if(k.isObject(a)){for(var b in a)return!1;return!0}return!1},k.isUndefined=function(a){return"undefined"==typeof a},k.isFunction=function(a){return"function"==typeof a},k.isObject=function(a){return"object"==typeof a}),b.prototype.schemaType=function(a,b){return k.isUndefined(b)?this._schemaTypes[a]:(this.Schema.Types[a]={name:a},void(this._schemaTypes[a]=b))},b.prototype.schemaFormat=function(a,b){return k.isUndefined(b)?this._schemaFormats[a]:(this.Schema.Types[a]={name:a},void(this._schemaFormats[a]=b))},b.prototype.model=function(a,b){return k.isUndefined(b)?l.Model.factory(a,this._schemas[a]):void(this._schemas[a]=b)};var l=new b;window.sly=l;var m={},n='Schema found type "{foundType}" where it expected type "{expectType}" => {val}';i.type=c,i.Types={},i.prototype.applySchema=function(a){return g(a,this.schema)},l.Schema=i,j.extend=function(a,b){var c=/^([\w\$]+)$/.test(a);if(!c)throw new Error('Invalid name: "{name}"'.supplant({name:a}));this.prototype[a]=b},j.factory=function(a,b){function c(a){k.extend(this,a)}return c.statics={},c.prototype=j.prototype,c.prototype.getName=function(){return a},c.prototype.getSchema=function(){return b},c},l.Model=j,l.schemaFormat("trim",function(a,b){return b&&(a=String(a).trim()),a}),l.Model.extend("check",function(){return this.getSchema().applySchema(this,arguments)}),String.prototype.supplant=function(a){"use strict";return this.replace(/{([^{}]*)}/g,function(b,c){var d=a[c];return"string"==typeof d||"number"==typeof d?d:b})},l.schemaType("Boolean",function(a){return k.isBoolean(a)}),l.schemaType("Date",function(a){return k.isDate(a)||k.isNumber(a)});var o=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;l.schemaType("Email",function(a){return o.test(a)}),l.schemaType("Mixed",function(){return!0}),l.schemaType("Number",function(a){return k.isNumber(a)});var p=/^\s*(\-)?\d+\s*$/;l.schemaType("Int",function(a){return-1!==String(a).search(p)});var q=/^\s*(\+|-)?((\d+(\.\d\d)?)|(\.\d\d))\s*$/;l.schemaType("Currency",function(a){var b=-1!==String(a).search(q);if(!b)throw new Error("Currency can have either 0 or 2 decimal places. => "+a);return b}),l.schemaType("String",function(a){return k.isString(a)})}()}({},function(){return this}());